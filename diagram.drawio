<mxfile host="app.diagrams.net" modified="2022-01-06T14:45:43.988Z" agent="5.0 (Windows)" etag="ooeBopoyG21P34Td1WNy" version="16.2.2" type="github">
  <diagram name="Page-1" id="74e2e168-ea6b-b213-b513-2b3c1d86103e">
    <mxGraphModel dx="1673" dy="964" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1654" pageHeight="1169" background="none" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="ehqzlcscsCSHqdPRzGeW-19" value="&lt;div&gt;&lt;b&gt;mlx5_ib_create_cq(struct ib_cq *ibcq, const struct ib_cq_init_attr *attr, struct ib_udata *udata)&lt;/b&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="400" height="1320" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-46" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Consolas;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DConsolas;" edge="1" parent="1" source="ehqzlcscsCSHqdPRzGeW-20" target="ehqzlcscsCSHqdPRzGeW-45">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-20" value="&lt;div&gt;&lt;b&gt;create_cq_user(struct mlx5_ib_dev *dev, struct ib_udata *udata, &lt;/b&gt;&lt;/div&gt;&lt;div align=&quot;center&quot;&gt;&lt;b&gt;struct mlx5_ib_cq *cq, int entries, u32 **cqb, int *cqe_size, int &lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;b&gt;*index, int *inlen)&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="520" y="160" width="400" height="620" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-43" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Consolas;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DConsolas;" edge="1" parent="1" source="ehqzlcscsCSHqdPRzGeW-32" target="ehqzlcscsCSHqdPRzGeW-36">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-32" value="&lt;b&gt;mlx5_ib_db_map_user(struct mlx5_ib_ucontext *context, struct ib_udata *udata, unsigned long virt, struct mlx5_db *db)&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="1000" y="340" width="400" height="360" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-44" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;fontFamily=Consolas;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DConsolas;" edge="1" parent="1" source="ehqzlcscsCSHqdPRzGeW-21" target="ehqzlcscsCSHqdPRzGeW-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-21" value="&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;create_cq_user(dev, udata, cq, entries, &amp;amp;cqb, &amp;amp;cqe_size, &amp;amp;index, &amp;amp;inlen);&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="310" width="380" height="50" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-29" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Consolas;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DConsolas;" edge="1" parent="1" source="ehqzlcscsCSHqdPRzGeW-24" target="ehqzlcscsCSHqdPRzGeW-28">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-24" value="&lt;div&gt;&lt;b&gt;Pin and DMA map user-space cqe memory&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;ucmdlen = min(udata-&amp;gt;inlen, sizeof(ucmd));&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;ib_copy_from_udata(&amp;amp;ucmd, udata, ucmdlen)&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;cq-&amp;gt;buf.umem = ib_umem_get(&amp;amp;dev-&amp;gt;ib_dev, ucmd.buf_addr, entries * ucmd.cqe_size, IB_ACCESS_LOCAL_WRITE);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="530" y="220" width="380" height="130" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-58" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;fontFamily=Consolas;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DConsolas;" edge="1" parent="1" source="ehqzlcscsCSHqdPRzGeW-28" target="ehqzlcscsCSHqdPRzGeW-32">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-28" value="&lt;div&gt;Map Doorbell to user-space&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;mlx5_ib_db_map_user(context, udata, ucmd.db_addr, &amp;amp;cq-&amp;gt;db);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="530" y="370" width="380" height="70" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-33" value="&lt;div&gt;&lt;b&gt;Pin and DMA map page if needed and add to DB page list&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font face=&quot;Consolas&quot;&gt;if (page with required VA exists)&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font face=&quot;Consolas&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;goto found;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;page = kmalloc(sizeof(*page), GFP_KERNEL);&lt;br&gt;page-&amp;gt;user_virt = (virt &amp;amp; PAGE_MASK);&lt;br&gt;page-&amp;gt;refcnt = 0;&lt;br&gt;page-&amp;gt;umem = ib_umem_get(context-&amp;gt;ibucontext.device, virt &amp;amp; PAGE_MASK, PAGE_SIZE, 0);&lt;br&gt;mmgrab(current-&amp;gt;mm);&lt;br&gt;page-&amp;gt;mm = current-&amp;gt;mm;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;list_add(&amp;amp;page-&amp;gt;list, &amp;amp;context-&amp;gt;db_page_list);&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;found:&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;db-&amp;gt;dma = sg_dma_address(page-&amp;gt;umem-&amp;gt;sg_head.sgl) + (virt &amp;amp; ~PAGE_MASK);&lt;br&gt;db-&amp;gt;u.user_page = page;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1010" y="390" width="380" height="300" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-36" value="&lt;div&gt;&lt;b&gt;&lt;font face=&quot;Helvetica&quot;&gt;Set command fields (&lt;i&gt;mlx5_ifc_create_cq_in_bits&lt;/i&gt;)&lt;br&gt;&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;Helvetica&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;Helvetica&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;page_size = mlx5_umem_find_best_cq_quantized_pgoff(cq-&amp;gt;buf.umem, cqc, log_page_size, MLX5_ADAPTER_PAGE_SHIFT, page_offset, 64, &amp;amp;page_offset_quantized);&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;Helvetica&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;cqc = MLX5_ADDR_OF(create_cq_in, *cqb, cq_context);&lt;br&gt;MLX5_SET(cqc, cqc, log_page_size, order_base_2(page_size) - MLX5_ADAPTER_PAGE_SHIFT);&lt;br&gt;MLX5_SET(cqc, cqc, page_offset, page_offset_quantized);&lt;br&gt;if (ucmd.cqe_comp_en == 1) {&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;MLX5_SET(cqc, cqc, cqe_comp_en, 1);&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;MLX5_SET(cqc, cqc, mini_cqe_res_format, mini_cqe_format);&lt;br&gt;}&lt;br&gt;MLX5_SET(create_cq_in, *cqb, uid, context-&amp;gt;devx_uid);&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Consolas;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DConsolas;" vertex="1" parent="1">
          <mxGeometry x="530" y="500" width="380" height="270" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-41" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Consolas;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DConsolas;" edge="1" parent="1" source="ehqzlcscsCSHqdPRzGeW-39" target="ehqzlcscsCSHqdPRzGeW-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-39" value="&lt;div align=&quot;center&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;Initialize &lt;i&gt;mlx5_ib_cq&lt;/i&gt; structure.&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;entries = attr-&amp;gt;cqe;&lt;br&gt;entries = roundup_pow_of_two(entries + 1);&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;cq-&amp;gt;ibcq.cqe = entries - 1;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;mutex_init(&amp;amp;cq-&amp;gt;resize_mutex);&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;spin_lock_init(&amp;amp;cq-&amp;gt;lock);&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;cq-&amp;gt;resize_buf = NULL;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;cq-&amp;gt;resize_umem = NULL:&lt;/font&gt;&lt;/div&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;cq-&amp;gt;create_flags = attr-&amp;gt;flags;&lt;br&gt;INIT_LIST_HEAD(&amp;amp;cq-&amp;gt;list_send_qp);&lt;br&gt;INIT_LIST_HEAD(&amp;amp;cq-&amp;gt;list_recv_qp);&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="90" width="380" height="200" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-48" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Consolas;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DConsolas;" edge="1" parent="1" source="ehqzlcscsCSHqdPRzGeW-45" target="ehqzlcscsCSHqdPRzGeW-47">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-45" value="&lt;div&gt;&lt;b&gt;&lt;font face=&quot;Helvetica&quot;&gt;Set command fields (&lt;i&gt;mlx5_ifc_create_cq_in_bits&lt;/i&gt;)&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;Helvetica&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;cqc = MLX5_ADDR_OF(create_cq_in, cqb, cq_context);&lt;br&gt;MLX5_SET(cqc, cqc, cqe_sz, cqe_sz_to_mlx_sz(cqe_size, cq-&amp;gt;private_flags &amp;amp; MLX5_IB_CQ_PR_FLAGS_CQE_128_PAD));&lt;br&gt;MLX5_SET(cqc, cqc, log_cq_size, ilog2(entries));&lt;br&gt;MLX5_SET(cqc, cqc, uar_page, index);&lt;br&gt;MLX5_SET(cqc, cqc, c_eqn, eqn);&lt;br&gt;MLX5_SET64(cqc, cqc, dbr_addr, cq-&amp;gt;db.dma);&lt;br&gt;if (cq-&amp;gt;create_flags &amp;amp; IB_UVERBS_CQ_FLAGS_IGNORE_OVERRUN)&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;MLX5_SET(cqc, cqc, oi, 1);&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Consolas;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DConsolas;" vertex="1" parent="1">
          <mxGeometry x="50" y="510" width="380" height="190" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-52" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;fontFamily=Consolas;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DConsolas;" edge="1" parent="1" source="ehqzlcscsCSHqdPRzGeW-47" target="ehqzlcscsCSHqdPRzGeW-49">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-47" value="mlx5_core_create_cq(dev-&amp;gt;mdev, &amp;amp;cq-&amp;gt;mcq, cqb, inlen, out, sizeof(out));&lt;br&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Consolas;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DConsolas;" vertex="1" parent="1">
          <mxGeometry x="50" y="960" width="380" height="50" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-54" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Consolas;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DConsolas;" edge="1" parent="1" source="ehqzlcscsCSHqdPRzGeW-49" target="ehqzlcscsCSHqdPRzGeW-53">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-49" value="&lt;b&gt;mlx5_core_create_cq(struct mlx5_core_dev *dev, struct mlx5_core_cq *cq, u32 *in, int inlen, u32 *out, int outlen)&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="520" y="900" width="400" height="440" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-50" value="&lt;div&gt;&lt;font face=&quot;Helvetica&quot;&gt;&lt;b&gt;Execute command and save info returned&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;Helvetica&quot;&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font face=&quot;Helvetica&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;MLX5_SET(create_cq_in, in, opcode, MLX5_CMD_OP_CREATE_CQ);&lt;br&gt;err = mlx5_cmd_exec(dev, in, inlen, out, outlen);&lt;br&gt;&lt;br&gt;cq-&amp;gt;cqn = MLX5_GET(create_cq_out, out, cqn);&lt;br&gt;cq-&amp;gt;cons_index = 0;&lt;br&gt;cq-&amp;gt;arm_sn&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; = 0;&lt;br&gt;cq-&amp;gt;eq&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; = eq;&lt;br&gt;cq-&amp;gt;uid = MLX5_GET(create_cq_in, in, uid);&lt;br&gt;refcount_set(&amp;amp;cq-&amp;gt;refcount, 1);&lt;br&gt;init_completion(&amp;amp;cq-&amp;gt;free);&lt;br&gt;if (!cq-&amp;gt;comp)&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;cq-&amp;gt;comp = mlx5_add_cq_to_tasklet;&lt;br&gt;/* assuming CQ will be deleted before the EQ */&lt;br&gt;cq-&amp;gt;tasklet_ctx.priv = &amp;amp;eq-&amp;gt;tasklet_ctx;&lt;br&gt;INIT_LIST_HEAD(&amp;amp;cq-&amp;gt;tasklet_ctx.list);&lt;br&gt;&lt;br&gt;/* Add to comp EQ CQ tree to recv comp events */&lt;br&gt;err = mlx5_eq_add_cq(&amp;amp;eq-&amp;gt;core, cq);&lt;br&gt;err = mlx5_eq_add_cq(mlx5_get_async_eq(dev), cq);&lt;br&gt;&lt;br&gt;cq-&amp;gt;pid = current-&amp;gt;pid;&lt;br&gt;cq-&amp;gt;uar = dev-&amp;gt;priv.uar&lt;/font&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Consolas;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DConsolas;" vertex="1" parent="1">
          <mxGeometry x="530" y="950" width="380" height="380" as="geometry" />
        </mxCell>
        <mxCell id="ehqzlcscsCSHqdPRzGeW-53" value="&lt;div&gt;&lt;font face=&quot;Helvetica&quot;&gt;&lt;b&gt;Save remaining info and update the out buffer to send CQn back to user-space application.&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;Helvetica&quot;&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;Helvetica&quot;&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;Helvetica&quot;&gt;&lt;font data-font-src=&quot;https://fonts.googleapis.com/css?family=Consolas&quot; face=&quot;Consolas&quot;&gt;err = mlx5_vector2eqn(dev-&amp;gt;mdev, vector, &amp;amp;eqn, &amp;amp;irqn);&lt;br&gt;&lt;br&gt;cq-&amp;gt;mcq.irqn = irqn;&lt;br&gt;cq-&amp;gt;mcq.comp&amp;nbsp; = mlx5_ib_cq_comp;&lt;br&gt;cq-&amp;gt;mcq.event = mlx5_ib_cq_event;&lt;br&gt;INIT_LIST_HEAD(&amp;amp;cq-&amp;gt;wc_list);&lt;br&gt;&lt;br&gt;ib_copy_to_udata(udata, &amp;amp;cq-&amp;gt;mcq.cqn, sizeof(__u32))&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt; " style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Consolas;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DConsolas;" vertex="1" parent="1">
          <mxGeometry x="50" y="1150" width="380" height="200" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
